# Volmageddon: An Analysis of Volatility Risk Premium Harvesting Strategies

This project conducts a detailed backtest and comparative analysis of two distinct strategies designed to harvest the Volatility Risk Premium (VRP). The analysis spans from early 2012 to early 2023, covering various market regimes including the "Volmageddon" event of February 2018 and the COVID-19 crisis.

The two primary methods explored are:

1. **Method 1: Long Short-Volatility ETF**: A simple buy-and-hold strategy on the SVXY (ProShares Short VIX Short-Term Futures ETF).
2. **Method 2: Systematic Short Strangle**: A rule-based strategy involving selling monthly delta-neutral SPY (SPDR S&P 500 ETF Trust) strangles.

The analysis relies on institutional-grade financial data from Wharton Research Data Services (WRDS), specifically CRSP for equity prices and OptionMetrics for historical options data.

---

## Directory Structure

The project is organized into several key directories:

```
Volmageddon/
├── Method_1/ # Core logic for the Long Short-Volatility ETF using WRDS data.
├── Method_2/ # Core logic for the Short Strangle strategy using WRDS data.
├── Method_1_yf/ # Preliminary implementation of Method 1 using yfinance for data.
├── tests/ # A development "scratchpad" for testing and visualization experiments.
└── Local_Data/ # (Essential) Contains all generated CSV data files for analysis and visualization.
```

### Directory Descriptions

- `Method_1`: Contains the complete workflow for analyzing the Long SVXY strategy. It fetches historical price data from the WRDS CRSP database, generates equity curves, calculates performance metrics, and analyzes return distributions.

- `Method_2`: Contains the more complex backtesting engine for the monthly SPY Short Strangle strategy. It uses WRDS OptionMetrics to fetch historical option chains, applies the trading logic, calculates P&L, linearizes the results into a daily series, and generates the final equity curve and performance metrics.

- `Method_1_yf`: An initial, cruder implementation of the Long SVXY strategy that uses the `yfinance` library for data retrieval. This served as a proof-of-concept before migrating to the more robust WRDS data.

- `tests`: This is a workbench directory or "rough section." It contains numerous scripts used for one-off tests, data validation (e.g., checking distinct trading dates), creating comparative visualizations, and experimenting with libraries and plotting techniques. The code here is experimental and supports the development of the core methods.

- `Local_Data`: This directory is **critical** for the project. It stores all the data generated by the data extraction and backtesting scripts. The analysis and visualization scripts read directly from this folder, making the process faster and more modular. *Note: This folder is generated by running the data-fetching scripts.*

---

## Methodologies

### Method 1: Harvesting VRP via Long SVXY

This strategy involves a simple buy-and-hold of the SVXY ETF.

- **Data Extraction (**`Method_1/price_data_extraction_wrds.py`**)**: Connects to the WRDS CRSP database to fetch daily adjusted prices for SVXY and the SPY benchmark.
- **Equity Curve Generation**: Calculates daily returns and builds both a raw equity curve and a unitized (starting from $1) equity curve.
- **Performance Analysis**:
  - **KPIs (**`KPIs_method_1.py`**)**: Calculates CAGR, Annualized Volatility, Sharpe Ratio, Max Drawdown, and Skewness across different market regimes.
  - **Drawdowns (**`Drawdown_method_1.py`**)**: Visualizes the drawdown periods and calculates statistics on recovery times.
  - **Distribution Analysis (**`KDE.py`**,** `QQ_Plot.py`**)**: Plots Kernel Density Estimation and Q-Q plots to analyze the non-normal nature of the strategy's returns.

### Method 2: Harvesting VRP via SPY Short Strangles

This is a systematic, non-directional options strategy. On the first trading day of each month, a short strangle is initiated on SPY.

- **Trade Logic**:
  1. The expiration date closest to **45 days-to-expiration (DTE)** is selected.
  2. A call option with a delta closest to **+0.25** is sold.
  3. A put option with a delta closest to **-0.25** is sold.
  4. The position is held to expiration.
- **Backtesting Engine**:
  - **Option Chain Retrieval (**`Method_2/option_chain_func.py`**)**: Connects to WRDS OptionMetrics to fetch the option chain for SPY on a given date and applies the DTE and delta logic to find the specific contracts to be traded.
  - **P&L Calculation (**`Method_2/one_month_test.py`**)**: Calculates the final P&L for a single monthly position by comparing the initial premium collected to the payout at expiration.
  - **Rolling Mechanism (**`Method_2/Rolling_mechanism.py`**)**: The main backtester. It iterates through every rebalancing day from 2012-2023, executes the trade logic, and aggregates the results into a final P&L DataFrame.
- **Equity Curve and Analysis**:
  - **Daily P&L Generation (**`Method_2/Linearizing_PnL.py`**)**: Since the P&L is only realized at month-end, this script linearizes the profit/loss over the trading days the position was held, creating a daily P&L series.
  - **Equity Curve Generation (**`Method_2/create_equity_curve.py`**)**: Uses the linearized daily P&L to construct the strategy's equity curve, scaled by an initial margin calculation.
  - The subsequent analysis (KPIs, Drawdowns, KDE/QQ plots) follows the same structure as in Method 1.

---

## Key Data Files (in `Local_Data/`)

The following CSV files are generated by the scripts and are essential for running the analysis and visualizations:

- `dinstinct_trading_dates.csv`: A master list of all valid NYSE trading days in the analysis period.
- `first_trading_day_of_eachMonth.csv`: The specific dates used for rebalancing in Method 2.
- `Final_PnL_DataFrame(Method-2).csv`: The primary output of the Method 2 backtest, containing the details and final P&L of each monthly strangle.
- `Linearized_PnL.csv`: The generated daily P&L for the Method 2 strategy.
- `SPY Unit Equity Curve Data.csv`: Daily unitized equity data for the SPY benchmark.
- `SVXY Unit Equity Curve Data.csv`: Daily unitized equity data for the Method 1 strategy.
- `Short Strangle Unit Equity Curve Data.csv`: Daily unitized equity data for the Method 2 strategy.

---

## Requirements

### Prerequisites

- Python 3.x
- Access to a **Wharton Research Data Services (WRDS)** subscription is required to run the primary data extraction scripts.
- A FRED API Key for downloading risk-free rate data.

### Python Libraries

- `pandas`
- `numpy`
- `matplotlib`
- `seaborn`
- `statsmodels`
- `wrds`
- `fredapi`
- `yfinance` (for `Method_1_yf/`)

You can install the required packages using pip:

pip install pandas numpy matplotlib seaborn statsmodels wrds fredapi yfinance